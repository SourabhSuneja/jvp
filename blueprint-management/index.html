<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Exam Blueprint - Jamna Vidyapeeth</title>
      <!-- Supabase CRUD Functions -->
      <script type="module" src="https://myjvp.in/commons/supabase-crud.js"></script>
      <!-- Dialog Box Styles -->
      <link rel="stylesheet" href="https://myjvp.in/commons/dialog.css">
      <!-- Dialog Box Scripts -->
      <script src="https://myjvp.in/commons/dialog.js"></script>
      <style>
         :root {
         --primary: #4f46e5;
         --primary-dark: #4338ca;
         --secondary: #10b981;
         --secondary-dark: #059669;
         --danger: #ef4444;
         --light: #f9fafb;
         --dark: #1f2937;
         --text: #374151;
         --border: #e5e7eb;
         --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
         --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
         --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
         --transition: all 0.2s ease;
         }
         * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
         max-height: 9999999px;
         }
         body {
         font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
         background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
         min-height: 100vh;
         padding: 20px;
         }
         .container {
         max-width: 1200px;
         margin: 0 auto;
         background: white;
         border-radius: 15px;
         box-shadow: 0 20px 40px rgba(0,0,0,0.1);
         overflow: hidden;
         }
         .header {
         background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
         color: white;
         padding: 30px;
         text-align: center;
         }
         .header img {
         height: 80px;
         width: auto;
         margin-bottom: 15px;
         border-radius: 10px;
         background: white;
         padding: 10px;
         }
         .header h1 {
         font-size: 2.2em;
         margin-bottom: 10px;
         font-weight: 600;
         }
         .header p {
         font-size: 1.1em;
         opacity: 0.9;
         }
         .loading-overlay {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(255, 255, 255, 0.8);
         display: flex;
         justify-content: center;
         align-items: center;
         z-index: 999999;
         }
         .spinner {
         width: 50px;
         height: 50px;
         border: 4px solid var(--border);
         border-radius: 50%;
         border-top-color: var(--primary);
         animation: spin 1s linear infinite;
         }
         @keyframes spin {
         to {
         transform: rotate(360deg);
         }
         }
         .hidden {
         display: none;
         }
         .tabs {
         display: flex;
         background: #f8f9fa;
         border-bottom: 3px solid #e9ecef;
         }
         .tab-button {
         flex: 1;
         padding: 20px;
         border: none;
         background: transparent;
         font-size: 1.1em;
         font-weight: 600;
         cursor: pointer;
         transition: all 0.3s ease;
         border-bottom: 3px solid transparent;
         }
         .tab-button.active {
         background: white;
         border-bottom-color: #3498db;
         color: #3498db;
         }
         .tab-button:hover:not(.active) {
         background: #e9ecef;
         }
         .tab-content {
         display: none;
         padding: 40px;
         }
         .tab-content.active {
         display: block;
         }
         .form-group {
         margin-bottom: 25px;
         }
         .form-row {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
         gap: 20px;
         margin-bottom: 25px;
         }
         label {
         display: block;
         margin-bottom: 8px;
         font-weight: 600;
         color: #2c3e50;
         font-size: 1em;
         }
         select, textarea {
         width: 100%;
         padding: 12px 15px;
         border: 2px solid #e9ecef;
         border-radius: 8px;
         font-size: 1em;
         transition: all 0.3s ease;
         font-family: inherit;
         }
         select:focus, textarea:focus {
         outline: none;
         border-color: #3498db;
         box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
         }
         textarea {
         min-height: 200px;
         resize: vertical;
         line-height: 1.5;
         }
         .submit-btn {
         background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
         color: white;
         border: none;
         padding: 15px 30px;
         border-radius: 8px;
         font-size: 1.1em;
         font-weight: 600;
         cursor: pointer;
         transition: all 0.3s ease;
         width: 100%;
         max-width: 225px;
         }
         .submit-btn:hover {
         transform: translateY(-2px);
         box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
         }
         .submit-btn:disabled {
         background: #95a5a6;
         cursor: not-allowed;
         transform: none;
         box-shadow: none;
         }
         .success-message {
         background: #d4edda;
         color: #155724;
         padding: 15px;
         border: 1px solid #c3e6cb;
         border-radius: 8px;
         margin-top: 20px;
         display: none;
         }
         .success-message.show {
         display: block;
         }
         .compiled-blueprints {
         display: none;
         }
         .compiled-blueprints.show {
         display: block;
         }
         .blueprint-item {
         background: #f8f9fa;
         border: 2px solid #e9ecef;
         border-radius: 10px;
         margin-bottom: 25px;
         overflow: hidden;
         }
         .blueprint-header {
         background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
         color: white;
         padding: 20px;
         font-weight: 600;
         font-size: 1.2em;
         }
         .blueprint-content {
         padding: 25px;
         white-space: pre-wrap;
         line-height: 1.6;
         background: white;
         }
         .print-btn {
         background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
         color: white;
         border: none;
         padding: 12px 25px;
         border-radius: 8px;
         font-size: 1em;
         font-weight: 600;
         cursor: pointer;
         transition: all 0.3s ease;
         margin-top: 20px;
         }
         .print-btn:hover {
         transform: translateY(-2px);
         box-shadow: 0 5px 15px rgba(155, 89, 182, 0.3);
         }
         .no-blueprints {
         text-align: center;
         padding: 60px 20px;
         color: #7f8c8d;
         font-size: 1.1em;
         }
         @media print {
         body {
         background: white;
         padding: 0;
         }
         .container {
         box-shadow: none;
         border-radius: 0;
         }
         .tabs, .tab-button, .print-btn, .form-group, .loading, select, .no-blueprints, #subheading, #submit-btn {
         display: none !important;
         }
         .tab-content {
         display: block !important;
         padding: 20px;
         }
         .header {
         background: white !important;
         color: #333 !important;
         border-bottom: 2px solid #333;
         page-break-after: avoid;
         }
         .header::after {
         content: "EXAM BLUEPRINTS";
         display: block;
         font-size: 1.5em;
         font-weight: bold;
         margin-top: 15px;
         text-align: center;
         color: #333;
         }
         .blueprint-item {
         break-inside: avoid;
         margin-bottom: 30px;
         border: 2px solid #333;
         page-break-inside: avoid;
         }
         .blueprint-header {
         background: #333 !important;
         -webkit-print-color-adjust: exact;
         print-color-adjust: exact;
         }
         }
         @media (max-width: 768px) {
         .tabs {
         flex-direction: column;
         }
         .form-row {
         grid-template-columns: 1fr;
         }
         .header h1 {
         font-size: 1.8em;
         }
         .tab-content {
         padding: 20px;
         }
         }
      </style>
   </head>
   <body>
      <div id="loading-overlay" class="loading-overlay">
         <div class="spinner"></div>
      </div>
      <div class="container">
         <div class="header">
            <img src="https://myjvp.in/commons/school-logo.jpg" alt="Jamna Vidyapeeth Logo">
            <h1>Jamna Vidyapeeth</h1>
            <p id="subheading">Exam Blueprint Management System</p>
         </div>
         <div class="tabs">
            <button class="tab-button active" onclick="switchTab('create')">Create/Edit Blueprint</button>
            <button class="tab-button" onclick="switchTab('view')">View Compiled Blueprint</button>
         </div>
         <div id="create-tab" class="tab-content active">
            <form id="blueprint-form">
               <div class="form-row">
                  <div class="form-group">
                     <label for="class-select">Select Class:</label>
                     <select id="class-select" required>
                        <option value="" disabled selected>Select Class</option>
                        <option value="1">Class 1</option>
                        <option value="2">Class 2</option>
                        <option value="3">Class 3</option>
                        <option value="4">Class 4</option>
                        <option value="5">Class 5</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                        <option value="11">Class 11</option>
                        <option value="12">Class 12</option>
                     </select>
                  </div>
                  <div class="form-group">
                     <label for="subject-select">Select Subject:</label>
                     <select id="subject-select" required>
                        <option value="" disabled selected>Select Subject</option>
                     </select>
                  </div>
                  <div class="form-group">
                     <label for="exam-select">Select Exam:</label>
                     <select id="exam-select" required>
                        <option value="" disabled selected>Select Exam</option>
                        <option value="PT-1">PT-1</option>
                        <option value="PT-2">PT-2</option>
                        <option value="Term-1">Term-1</option>
                        <option value="PT-3">PT-3</option>
                        <option value="PT-4">PT-4</option>
                        <option value="Term-2">Term-2</option>
                        <option value="Enthusiasm Exam">Enthusiasm Exam</option>
                     </select>
                  </div>
               </div>
               <div class="form-group">
                  <label for="blueprint-text">Blueprint Content:</label>
                  <textarea id="blueprint-text" placeholder="Enter the exam blueprint details here..." required></textarea>
               </div>
               <button type="submit" class="submit-btn" id="submit-btn">Submit Blueprint</button>
               <div class="success-message" id="success-message">
                  Blueprint submitted successfully!
               </div>
            </form>
         </div>
         <div id="view-tab" class="tab-content">
            <div class="form-group">
               <label for="view-class-select">Select Class to View Blueprints:</label>
               <select id="view-class-select" onchange="fetchBlueprints()">
                  <option value="" disabled selected>Select Class</option>
                  <option value="1">Class 1</option>
                  <option value="2">Class 2</option>
                  <option value="3">Class 3</option>
                  <option value="4">Class 4</option>
                  <option value="5">Class 5</option>
                  <option value="6">Class 6</option>
                  <option value="7">Class 7</option>
                  <option value="8">Class 8</option>
                  <option value="9">Class 9</option>
                  <option value="10">Class 10</option>
                  <option value="11">Class 11</option>
                  <option value="12">Class 12</option>
               </select>
            </div>
            <div class="compiled-blueprints" id="compiled-blueprints">
               <button class="print-btn" onclick="window.print()">Print Blueprints</button>
               <div id="blueprints-container"></div>
            </div>
            <div class="no-blueprints" id="no-blueprints">
               <p>No blueprints found for the selected class.</p>
            </div>
         </div>
      </div>
      <!-- Dialog Overlay Starts -->
      <div id="dialog-overlay" class="dialog-overlay">
         <div class="dialog-box" id="dialog-box">
            <div class="dialog-header" id="dialog-header">Title</div>
            <div class="dialog-message" id="dialog-message">Message goes here</div>
            <div class="dialog-buttons" id="dialog-buttons">
               <!-- Buttons will be added dynamically -->
            </div>
         </div>
      </div>
      <!-- Dialog Overlay Ends -->
      <script>
         const SUBJECTS = [
             'English', 'Hindi', 'Maths', 'Applied Maths', 'Science', 
             'Social Science', 'EVS', 'Sanskrit', 'GK', 'Computer', 'Data Science', 'Informatics Practices', 'Physical Education',
             'Accountancy', 'Business Studies', 'Economics', 'History', 'Geography', 'Political Science',
             'Psychology','Fine Arts', 'Physics', 'Chemistry', 'Biology'
         ];
         
          // DOM Elements
          const loadingOverlay = document.getElementById('loading-overlay');
         
          // Helper Functions
          function showLoading() {
              loadingOverlay.classList.remove('hidden');
          }
          
          function hideLoading() {
              loadingOverlay.classList.add('hidden');
          }
         
         // Initialize subjects dropdown
         function initializeSubjects() {
             const subjectSelect = document.getElementById('subject-select');
             SUBJECTS.forEach(subject => {
                 const option = document.createElement('option');
                 option.value = subject;
                 option.textContent = subject;
                 subjectSelect.appendChild(option);
             });
         }
         
         // Switch between tabs
         function switchTab(tabName) {
             // Remove active class from all tabs and buttons
             document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
             document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
             
             // Add active class to current tab and button
             document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
             document.getElementById(`${tabName}-tab`).classList.add('active');
         }
         
         // Handle form submission
         document.getElementById('blueprint-form').addEventListener('submit', async function(e) {
             e.preventDefault();
             
             const classValue = document.getElementById('class-select').value;
             const subjectValue = document.getElementById('subject-select').value;
             const examValue = document.getElementById('exam-select').value;
             const blueprintValue = document.getElementById('blueprint-text').value;
         
             if (!classValue || !subjectValue || !examValue || !blueprintValue) {
                 alert('Please fill in all fields before submitting.');
                 return;
             }
         
             const blueprint = {
                 class: classValue,
                 exam: examValue,
                 subject: subjectValue,
                 blueprint: blueprintValue
             };
         
             // Show loading
             showLoading();
             document.getElementById('submit-btn').disabled = true;
             //document.getElementById('success-message').classList.remove('show');
         
             // Upsert on Supabase
             const result = await upsertData('blueprint', blueprint, conflictColumns = ['class', 'subject', 'exam']);
             if(result) {
               showDialog({
                   title: 'Success',
                   message: 'Blueprint saved successfully!',
                   type: 'alert'
                   });
             } else {
               showDialog({
                   title: 'Error',
                   message: 'Error updating the blueprint!',
                   type: 'alert'
                   });
             }

             // Hide loading
             hideLoading();
             document.getElementById('submit-btn').disabled = false;
             //document.getElementById('success-message').classList.add('show');
         });
         
         // Fetch blueprints for viewing
         async function fetchBlueprints() {
             const selectedClass = document.getElementById('view-class-select').value;
             if (!selectedClass) return;
         
             // Hide previous results
             document.getElementById('compiled-blueprints').classList.remove('show');
             document.getElementById('no-blueprints').style.display = 'none';
             
             // Show loading
             showLoading();
         
             // Fetch the blueprint for the selected class from Supabase
             const response = await selectData(
                                 'blueprint',
                                 fetchSingle = false,
                                 columns = 'class, subject, exam, blueprint',
                                 matchColumns = ['class'],
                                 matchValues = [parseInt(selectedClass)]
                              );
             if(response) {
                  displayBlueprints(response);
             }
             // Hide loading
             hideLoading();
         }
         
         // Display blueprints
         function displayBlueprints(blueprints) {
             const container = document.getElementById('blueprints-container');
             
             if (!blueprints || blueprints.length === 0) {
                 document.getElementById('no-blueprints').style.display = 'block';
                 return;
             }
         
             // Sort blueprints according to SUBJECTS order
             const sortedBlueprints = blueprints.sort((a, b) => {
                 const indexA = SUBJECTS.indexOf(a.subject);
                 const indexB = SUBJECTS.indexOf(b.subject);
                 return indexA - indexB;
             });
         
             container.innerHTML = '';
             
             sortedBlueprints.forEach(blueprint => {
                 const blueprintItem = document.createElement('div');
                 blueprintItem.className = 'blueprint-item';
                 blueprintItem.innerHTML = `
                     <div class="blueprint-header">
                         ${blueprint.subject} - ${blueprint.exam} (Class ${blueprint.class})
                     </div>
                     <div class="blueprint-content">${blueprint.blueprint}</div>
                 `;
                 container.appendChild(blueprintItem);
             });
         
             document.getElementById('compiled-blueprints').classList.add('show');
         }
         
         // Initialize the page
         document.addEventListener('DOMContentLoaded', function() {
             initializeSubjects();
         });
         
         // Check auth on page load
         window.addEventListener('load', async function() {
         // Show loading
         showLoading();
         try {
         const isAuthenticated = await checkAuth();
         if (!isAuthenticated) {
             window.location = "https://myjvp.in/teachers/?ref=" + encodeURIComponent(window.location.href);
         } else {
             // User is logged in, hide loading
             hideLoading();
         }
         } catch (error) {
         console.error('Auth check error:', error);
         }
         }, false);
      </script>
   </body>
</html>
